Tripartite={templates:{defaultTemplate:function(a){return""+a}},constants:{templateBoundary:"__",templateNameBoundary:"##"},secondaryTemplateFunctionObject:window};Tripartite.SimpleTemplate=function(b,d,a){var c=new Tripartite.ActiveElement(b,d,a);return function(e){return c.run(e)}};Tripartite.ActiveElement=function(b,c,a){this.conditionalExpression=b;this.dataSelectorExpression=c;if(a){this.handlingExpression=a}else{this.handlingExpression="defaultTemplate"}this.evaluatedData=null};Tripartite.ActiveElement.prototype.run=function(c){var e=false;this.evaluatedData=this.evaluateDataSelectorExpression(c);if(this.conditionalExpression){e=this.evaluateInContext(c,this.conditionalExpression)}else{if(this.evaluatedData instanceof Array){if(this.evaluatedData.length>0){e=true}}else{if(this.evaluatedData){e=true}}}var b=this.handlingExpression;if(b.charAt(0)=="$"){b=this.evaluateInContext(c,b.substring(1))}if(!b){b="defaultTemplate"}if(e){if(this.evaluatedData instanceof Array){var a="";for(var d=0;d<this.evaluatedData.length;d++){a+=Tripartite.templates[b](this.evaluatedData[d])}return a}else{return Tripartite.templates[b](this.evaluatedData)}}return""};Tripartite.ActiveElement.prototype.evaluateDataSelectorExpression=function(a){if(!this.dataSelectorExpression){return null}if(this.dataSelectorExpression==="$this"){return a}return this.evaluateInContext(a,this.dataSelectorExpression)};Tripartite.ActiveElement.prototype.evaluateInContext=function(currentContext,expression){with(currentContext){try{return eval(expression)}catch(e){return null}}};Tripartite.addTemplate=function(b,a){if(typeof a!=="function"){a=Tripartite.parseTemplate(a)}Tripartite.templates[b]=a;return a};Tripartite.parseTemplateScript=function(e){var f=Tripartite.tokenizeTemplateScript(e);var c=null;for(var b=0;b<f.length;b++){var a=f[b];if(a.active){c=a.content}else{if(c){var d=Tripartite.addTemplate(c,a.content);if(Tripartite.secondaryTemplateFunctionObject){Tripartite.secondaryTemplateFunctionObject[c]=d}c=null}}}};Tripartite.parseTemplate=function(c){var e=Tripartite.tokenizeTemplate(c);var d=[];for(var b=0;b<e.length;b++){var a=e[b];if(a.active){d.push(Tripartite.tokenizeActivePart(a.content))}else{if(a.content){d.push(a.content)}}}return function(g){var f="";for(var h=0;h<d.length;h++){if(typeof d[h]==="string"){f+=d[h]}else{f+=d[h](g)}}return f}};Tripartite.tokenizeActivePart=function(b){var a=null;var e=null;var f=null;var c=b.indexOf("??");if(c>-1){a=b.substring(0,c);c+=2}else{c=0}var d=b.indexOf("::");if(d>-1){e=b.substring(c,d);f=b.substring(d+2)}else{e=b.substring(c)}return new Tripartite.SimpleTemplate(a,e,f)};Tripartite.tokenizeTemplate=function(a){return Tripartite.tokenizeActiveInactiveBlocks(a,Tripartite.constants.templateBoundary)};Tripartite.tokenizeTemplateScript=function(a){return Tripartite.tokenizeActiveInactiveBlocks(a,Tripartite.constants.templateNameBoundary)};Tripartite.tokenizeActiveInactiveBlocks=function(g,a){var e=g.length;var f=0;var b=false;var h=[];while(f<e){var c=g.indexOf(a,f);if(c==-1){c=e}var d={active:b,content:g.substring(f,c)};h.push(d);f=c+2;b=!b}return h};